<html>
<head>
	<link href="/bootstrap/css/bootstrap.min.css" rel="stylesheet"></link>
	<script src="/jquery-1.8.3.min.js"></script>
	<script src="/bootstrap/js/bootstrap.min.js"></script>
	<script src="/d3.v3.min.js"></script>
</head>
<body>
	<div class="container">
		<div class="hero-unit"> 
			<h1> WaterFlow </h1>
			<p> 流水 </p>
			<button id="go" class="btn btn-primary btn-large"> test </button>
		</div>
		<table class="table table-condensed">
			<thead>
				<tr>
					<th> Time </th>
					<th> User ID </th>
					<th> Dept ID</th>
					<th> Operator </th>
				</tr>
			</thead>
			<tbody id="list"> </tbody>
		</table>
	</div>
</body>
<script src="/socket.io/socket.io.js"></script>
<script>
  var socket = io.connect('http://box.home:8080');
  $("#go").click(function(){
	  console.log("log");
	  socket.emit("log",  { 
	  	timeIn: new Date().getTime(),
	  	uid: Math.floor(Math.random() * 1001),
	  	did: Math.floor(Math.random() * 11), 
	  });
  });
  socket.emit("listready", {});
  socket.on('list', function (data) { 
	  $("tbody#list").html("");
	  table = d3.select("tbody#list");
	  var tr = table.selectAll("tr")
	  		.data(data)
	  		.enter().append("tr");

	  tr.append("td")
	  	.text(function(d){return d.timeIn;});

	  tr.append("td")
	  	.text(function(d){return d.uid;});

	  tr.append("td")
	  	.text(function(d){return d.did;});

	  tr.append("td")
	  	.append("i")
	  	.on("click", function(d){
	  		console.log(d._id);
	  		socket.emit("delRec", d._id);
	  	})
	  	.attr("class", "icon-remove");
	  
	  setTimeout(function(){
		  console.log("listready");
		  socket.emit("listready", {})
	  }, 3000);
  });
</script>
</html>
